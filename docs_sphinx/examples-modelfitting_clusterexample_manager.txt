.. currentmodule:: brian

.. _example-modelfitting_clusterexample_manager:

.. index::
   pair: example usage; Equations
   pair: example usage; equations

Example: clusterexample_manager (modelfitting)
==============================================

Model fitting example using a cluster.

Fits an integrate-and-fire model to an in-vitro electrophysiological 
recording over one second.

This script is the 'manager' script and should be run after all the workers
have started.

::

	from brian import *
	from brian.library.modelfitting import *
	
	if __name__ == '__main__':
	    
	    equations = Equations('''
	        dV/dt=(R*I-V)/tau : 1
	        I : 1
	        R : 1
	        tau : second
	    ''')
	    
	    input = loadtxt('current.txt')
	    spikes = loadtxt('spikes.txt')
	    
        # Change this line to the hostnames or IP addresses of the workers
        machines = ['localhost']
	    
	    results = modelfitting(model = equations, reset = 0, threshold = 1,
                               data = spikes, 
                               input = input, dt = .1*ms,
                               particles = 1000, iterations = 1, delta = 2*ms,
                               use_gpu = False, max_cpu = 1, machines = machines,
                               R = [1.0e9, 9.0e9], tau = [10*ms, 40*ms])
	    
	    print_results(results)
